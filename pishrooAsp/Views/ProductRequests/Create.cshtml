@model pishrooAsp.Models.ProductRequest.ProductRequest
@{
    ViewBag.dir = ViewBag.IsRtl;
    var isRtl = ViewBag.IsRtl;
    var labels = ViewBag.Labels as Dictionary<string, string>;
    var culture = ViewBag.Culture;
}
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<div dir="@(isRtl ? "rtl" : "ltr")" class="max-w-4xl mx-auto p-6">
    @if (TempData["Success"] != null)
    {
        <div class="mb-4 p-4 rounded-lg bg-green-50 border border-green-200 text-green-800 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 @(isRtl ? "ml-2" : "mr-2")" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
            </svg>
            @TempData["Success"]
        </div>
    }

    <h1 class="text-2xl font-semibold mb-6">@labels["FormTitle"]</h1>
    <p class="text-sm text-gray-500 mb-6">@labels["RequiredField"] <span class="text-red-600">*</span></p>

    <form asp-action="Create" method="post" enctype="multipart/form-data" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Full Name -->
            <div>
                <label asp-for="FullName" class="block text-sm font-medium mb-1">@labels["FullName"] <span class="text-red-600">*</span></label>
                <input asp-for="FullName" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300"
                       placeholder="@labels["ExampleFullName"]" required />
                <span asp-validation-for="FullName" class="text-sm text-red-600 mt-1 block"></span>
            </div>

            <!-- Phone Number -->
            <div>
                <label asp-for="PhoneNumber" class="block text-sm font-medium mb-1">@labels["PhoneNumber"] <span class="text-red-600">*</span></label>
                <input asp-for="PhoneNumber" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300"
                       placeholder="@labels["ExamplePhone"]" required />
                <span asp-validation-for="PhoneNumber" class="text-sm text-red-600 mt-1 block"></span>
            </div>

            <!-- Company Name -->
            <div>
                <label asp-for="CompanyName" class="block text-sm font-medium mb-1">@labels["CompanyName"]</label>
                <input asp-for="CompanyName" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300"
                       placeholder="@labels["ExampleCompany"]" />
                <span asp-validation-for="CompanyName" class="text-sm text-red-600 mt-1 block"></span>
            </div>

            <!-- Company Phone -->
            <div>
                <label asp-for="CompanyPhone" class="block text-sm font-medium mb-1">@labels["CompanyPhone"]</label>
                <input asp-for="CompanyPhone" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300" />
                <span asp-validation-for="CompanyPhone" class="text-sm text-red-600 mt-1 block"></span>
            </div>

            <!-- Injection Method -->
            <div>
                <label asp-for="InjectionMethod" class="block text-sm font-medium mb-1">@labels["InjectionMethod"]</label>
                <select asp-for="InjectionMethod" class="w-full rounded-lg border border-gray-300 px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-300">
                    <option value="">@labels["SelectOption"]</option>
                    <option value="تزریقی">@(isRtl ? "تزریقی" : "Injection")</option>
                    <option value="اکستروژن">@(isRtl ? "اکستروژن" : "Extrusion")</option>
                    <option value="بادی">@(isRtl ? "بادی" : "Blow")</option>
                </select>
                <span asp-validation-for="InjectionMethod" class="text-sm text-red-600 mt-1 block"></span>
            </div>

            <!-- Product Type -->
            <div>
                <label asp-for="ProductType" class="block text-sm font-medium mb-1">@labels["ProductType"]</label>
                <select asp-for="ProductType" class="w-full rounded-lg border border-gray-300 px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-300">
                    <option value="">@labels["SelectOption"]</option>
                    @if (ViewBag.Product != null)
                    {
                        foreach (var product in ViewBag.Product)
                        {
                            <option value="@product">@product</option>
                        }
                    }
                    else
                    {
                        <option disabled>@labels["NoProductFound"]</option>
                    }
                </select>
                <span asp-validation-for="ProductType" class="text-sm text-red-600 mt-1 block"></span>
            </div>

            <!-- Required Amount -->
            <div>
                <label asp-for="RequiredAmountKg" class="block text-sm font-medium mb-1">@labels["RequiredAmount"]</label>
                <input asp-for="RequiredAmountKg" type="number" step="0.01" min="0"
                       class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300"
                       placeholder="@labels["ExampleAmount"]" />
                <span asp-validation-for="RequiredAmountKg" class="text-sm text-red-600 mt-1 block"></span>
            </div>

            <!-- Softness/Hardness -->
            <div class="md:col-span-2">
                <label class="block text-sm font-medium mb-1">
                    @labels["SoftnessHardness"] <span class="text-red-600">*</span>
                </label>
                <span id="softness-hardness-error" class="text-sm text-red-600 mt-1 block hidden">
                    @labels["SoftnessHardnessError"]
                </span>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-2">
                    <div>
                        <label asp-for="SoftnessA" class="block text-sm font-medium mb-1">@labels["SoftnessA"]</label>
                        <input asp-for="SoftnessA" type="number" min="0" max="90"
                               class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300"
                               placeholder="@(isRtl ? "0 – 90" : "0 - 90")" id="a" />
                        <span asp-validation-for="SoftnessA" class="text-sm text-red-600 mt-1 block"></span>
                    </div>

                    <div>
                        <label asp-for="HardnessB" class="block text-sm font-medium mb-1">@labels["HardnessB"]</label>
                        <input asp-for="HardnessB" type="number" min="10" max="50"
                               class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300"
                               placeholder="@(isRtl ? "10 – 50" : "10 - 50")" id="b" />
                        <span asp-validation-for="HardnessB" class="text-sm text-red-600 mt-1 block"></span>
                    </div>
                </div>
            </div>

            <!-- File Upload -->
            <div class="md:col-span-2">
                <label class="block text-sm font-medium mb-1">@labels["FileUpload"]</label>
                <div class="flex flex-col gap-3">
                    <div class="flex items-center gap-3">
                        <label class="cursor-pointer inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 @(isRtl ? "ml-2" : "mr-2")" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                            </svg>
                            <span class="text-sm">@(isRtl ? "انتخاب فایل‌ها" : "Choose Files")</span>
                            <input asp-for="UploadFiles" type="file" multiple class="hidden" id="fileInput" />
                        </label>
                    </div>

                    <!-- File preview area -->
                    <div id="filePreview" class="hidden mt-2 p-3 bg-gray-50 rounded-lg border border-gray-200">
                        <p class="text-sm font-medium mb-2">@(isRtl ? "فایل‌های انتخاب شده:" : "Selected files:")</p>
                        <ul id="fileList" class="text-sm text-gray-600 space-y-1"></ul>
                    </div>

                    <span class="text-sm text-gray-500">@labels["FileRequirements"]</span>
                </div>
            </div>

            <!-- Description -->
            <div class="md:col-span-2">
                <label asp-for="Description" class="block text-sm font-medium mb-1">@labels["Description"]</label>
                <textarea asp-for="Description" rows="4"
                          class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300"
                          placeholder="@(isRtl ? "یادداشت یا توضیحات تکمیلی..." : "Additional notes or comments...")"></textarea>
                <span asp-validation-for="Description" class="text-sm text-red-600 mt-1 block"></span>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="flex items-center justify-between gap-4">
            <div>
                <a asp-controller="home" asp-action="index" class="inline-flex items-center text-sm px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50">
                    @if (isRtl)
                    {
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                        </svg>
                    }
                    else
                    {
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                    }
                    @labels["BackToList"]
                </a>
            </div>

            <button type="submit" class="ml-auto bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg shadow flex items-center">
                @labels["Submit"]
                @if (!isRtl)
                {
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                }
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // File upload preview functionality
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const filePreview = document.getElementById('filePreview');
            const fileList = document.getElementById('fileList');

            fileList.innerHTML = '';

            if (this.files.length > 0) {
                filePreview.classList.remove('hidden');

                Array.from(this.files).forEach(file => {
                    const listItem = document.createElement('li');
                    listItem.className = 'flex items-center justify-between';
                    listItem.innerHTML = `
                        <span>${file.name}</span>
                        <span class="text-xs text-gray-500">${formatFileSize(file.size)}</span>
                    `;
                    fileList.appendChild(listItem);
                });
            } else {
                filePreview.classList.add('hidden');
            }
        });

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        const a = document.getElementById("a")
        const b = document.getElementById("b")

        a.addEventListener("keyup",()=>{
            if(a.value == "") {
                b.disabled = false;
            }
            else{
                b.disabled = true;
            }
        })

        b.addEventListener("keyup",()=>{
            if(b.value == ""){
                a.disabled = false;
            }
            else{
                a.disabled = true;
            }
        })

        // اعتبارسنجی سفارشی برای Softness/Hardness
        $(document).ready(function() {
            $('form').submit(function(e) {
                var softnessA = $('#SoftnessA').val();
                var hardnessB = $('#HardnessB').val();
                var errorElement = $('#softness-hardness-error');

                if (!softnessA && !hardnessB) {
                    errorElement.text('@(isRtl ? "لطفا یکی از فیلدهای نرمی یا سختی را پر کنید" : "Please fill either Softness or Hardness field")').show();
                    e.preventDefault();
                } else if (softnessA && hardnessB) {
                    errorElement.text('@(isRtl ? "لطفا فقط یکی از فیلدها را پر کنید" : "Please fill only one field")').show();
                    e.preventDefault();
                }
            });

            // نمایش/پنهان کردن پیام خطا هنگام تغییر مقدار
            $('#SoftnessA, #HardnessB').on('input', function() {
                $('#softness-hardness-error').hide();
            });
        });
    </script>
}